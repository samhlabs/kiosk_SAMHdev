!function(e){e.infinitedrag=function(e,n,i){return new t(e,n,i)},e.infinitedrag.serializeTiles=function(t){var n=[];return e.each(t,function(e,t){n.push(t.x+";"+t.y)}),n.join()};var t=function(t,n,i){function o(e,t){var n=e,i=t;if(e<s.range_col[0]||s.range_col[1]<e){if(!s.loop_ranges)return;e<s.range_col[0]&&(e=s.range_col[1]),s.range_col[1]<e&&(e=s.range_col[0])}if(t<s.range_row[0]||s.range_row[1]<t){if(!s.loop_ranges)return;t<s.range_row[0]&&(t=s.range_row[1]),s.range_row[1]<t&&(t=s.range_row[0])}var o=(e*s.width,t*s.height,l.append("<div></div>")),a=o.children(":last");f(a,e,t),a.attr({"class":s.class_name,col:e,row:t}),r(a,n,i),s.on_aggregate&&(u.push({tile:a,x:e,y:t}),0===_&&(_=setTimeout(g,s.aggregate_time))),s.oncreate.call(h,a,e,t)}function a(t){var n=e(t).attr("col"),i=e(t).attr("row");"undefined"!=typeof n&&"undefined"!=typeof i&&("undefined"==typeof z[n]&&(z[n]={}),f(t,n,i),r(t,n,i))}function r(t,n,i){var o=n*s.width,a=i*s.height;e(t).css({position:"absolute",left:o,top:a,width:s.width,height:s.height})}function f(t,n,i){z[n][i]=e(t).get(0),"undefined"==typeof z[n].cnt&&(z[n].cnt=0),z[n].cnt++}function g(){s.on_aggregate.call(h,u),_=0,u=[]}var h=this,l=e(t),c=l.parent();l.css({position:"relative"});var d={shouldEase:!1,cursor:!0};e.extend(d,n),d.cursor&&l.css({cursor:"move"});var s={class_name:"_tile",width:100,height:100,start_col:0,start_row:0,range_col:[-1e6,1e6],range_row:[-1e6,1e6],loop_ranges:!1,margin:0,cleaning_enabled:!0,remove_buffer:10,draggable_lib:e.fn.pep?"pep":"draggable",oncreate:function(e,t,n){e.text(t+","+n)},on_aggregate:!1,aggregate_time:10};e.extend(s,i),"x"==d.axis?s.range_row=[s.start_row,s.start_row]:"y"==d.axis&&(s.range_col=[s.start_col,s.start_col]);var u=[],_=0;h.update_containment=function(){m=c.css("zoom"),b=c.width()+2*s.margin,y=c.height()+2*s.margin,x=Math.ceil(b/s.width),M=Math.ceil(y/s.height);var e=(s.width/2,s.height/2,c.offset()),t=b/m-s.width,n=y/m-s.height,i=[-s.range_col[1]*s.width+e.left+t,-s.range_row[1]*s.height+e.top+n,-s.range_col[0]*s.width+e.left,-s.range_row[0]*s.height+e.top];"draggable"==s.draggable_lib&&l.draggable("option","containment",i),w()};var p={left:0,top:0},w=function(e){"undefined"==typeof e&&(e={left:0,top:0});for(var t=l,n=t.parent(),i={left:t.offset().left-n.offset().left+s.margin,top:t.offset().top-n.offset().top+s.margin},a=Math.ceil(-i.left/s.width)-1,r=Math.ceil(-i.top/s.height)-1,f=a;a+x>=f;f++){"undefined"==typeof z[f]&&(z[f]={});for(var g=r;r+M>=g;g++)"undefined"==typeof z[f][g]&&o(f,g)}(Math.abs(e.left-p.left)>s.remove_buffer*s.width||Math.abs(e.top-p.top)>s.remove_buffer*s.height)&&(v(a,r),p=e)},v=function(t,n){if(!s.cleaning_enabled){var i=t+x+1,o=n+M;e.each(z,function(a,r){e.each(r,function(r,f){"cnt"!==r&&(t>a||a>i||n>r||r>o)&&(delete z[a][r],z[a].cnt--,0==z[a].cnt&&delete z[a],e(f).remove())})})}};h.draggable=function(){return l},h.disabled=function(t){return void 0===t?l:(e.fn.pep?e.pep.toggleAll(!t):l.draggable("option","disabled",t),d.cursor&&l.css({cursor:t?"default":"move"}),void 0)},h.center=function(e,t){var n=s.width*e,i=s.height*t,o=s.width/2,a=s.height/2,r=c.width()/2,f=c.height()/2,g=l.offset(),h={left:-n-(o-r),top:-i-(a-f)};"x"==d.axis?h.top=g.top:"y"==d.axis&&(h.left=g.left),l.offset(h),w(h)},h.get_tile_dimensions=function(){var e={width:s.width,height:s.height};return e},h.get_tile=function(t,n){return"undefined"!=typeof z[t]&&"undefined"!=typeof z[t][n]?e(z[t][n]):null},0==c.height()&&c.css({"min-height":"300px"});var m=c.css("zoom"),b=c.width()+2*s.margin,y=c.height()+2*s.margin,x=Math.ceil(b/s.width),M=Math.ceil(y/s.height);l.offset({left:c.offset().left-s.start_col*s.width,top:c.offset().top-s.start_row*s.height});var z={};l.children("."+s.class_name).each(function(){a(this)}),w(),e(window).resize(function(){h.update_containment()}),d.drag=function(e,t){w(t.position)},l[s.draggable_lib](d),h.update_containment()}}(jQuery);